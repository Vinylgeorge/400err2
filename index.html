// ==UserScript==
// @name         MTurk HIT → JSONBin
// @namespace    Violentmonkey Scripts
// @match        https://worker.mturk.com/tasks*
// @grant        GM_xmlhttpRequest
// ==/UserScript==

(function() {
  'use strict';

  function sendHitToJsonBin(hit) {
    const binId = "68c88afcd0ea881f407f17fd";    // your Bin ID
    const apiKey = "$2a$10$tGWSdPOsZbt7ecxcUqPwaOPrtBrw84TrZQDZtPvWN5Hpm595sHtUm"; // your API key

    GM_xmlhttpRequest({
      method: "PUT",
      url: `https://api.jsonbin.io/v3/b/${binId}`,
      headers: {
        "Content-Type": "application/json",
        "X-Master-Key": apiKey
      },
      data: JSON.stringify(hit),
      onload: res => console.log("✅ HIT saved:", res.responseText),
      onerror: err => console.error("❌ Error saving:", err)
    });
  }

  // Example test HIT (replace with your real MTurk hook later)
  const exampleHit = {
    event: "hit_accepted",
    requester: "Shopping Receipts",
    reward: "0.01",
    workerId: "A27WGJXVQ1H0UB",
    assignmentId: "31QTRG6Q2UXOQYJNSRS5PPNZ893PY6",
    hitId: "372AGES0I4OHGMCYAL5RMMK99WYXRR",
    title: "Extract General Data & Items From Shopping Receipt",
    timeRemainingSeconds: 3599,
    time: new Date().toISOString()
  };

  // Test send once
  sendHitToJsonBin(exampleHit);
})();
