<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>📊 MTurk Earnings Dashboard</title>
<style>
:root{--bg:#0b1020;--card:#12172a;--ink:#e7eefc;--mut:#9fb2d9;--acc:#63b3ff;--bad:#ffcaca;--good:#d7ffde}
*{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(180deg,#0b1020,#0a0f24 40%,#0b122a);color:var(--ink)}
header{padding:22px 18px;text-align:center}
h1{margin:.2rem 0 .5rem;font-size:clamp(18px,3.5vw,26px);font-weight:700}
h1 span{color:var(--acc)}
p.hint{margin:0;color:var(--mut);font-size:.95rem}
.main{max-width:1100px;margin:14px auto 28px;padding:14px}
.controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin:10px 0 14px}
.input,button{border:0;outline:0;border-radius:10px}
.input{padding:10px 12px;background:#0f152a;color:var(--ink);border:1px solid #1a2344;min-width:260px}
.btn{background:linear-gradient(180deg,#2a7fff,#1a62d6);color:white;padding:10px 14px;font-weight:600;cursor:pointer}
.btn:hover{filter:brightness(1.05)}
.table-wrap{background:var(--card);border:1px solid #1a2344;border-radius:14px;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,.25)}
table{width:100%;border-collapse:collapse}
th,td{padding:10px 12px;border-bottom:1px dashed #1a2344;font-size:13.5px;vertical-align:top}
th{background:#0f152a;color:#cde0ff;text-align:left}
tr.alert{background:rgba(255,96,96,.08)}
tr:hover{background:rgba(255,255,255,.02)}
footer{opacity:.75;text-align:center;padding:12px;font-size:12px;color:var(--mut)}
.lock{position:fixed;inset:0;background:radial-gradient(1200px 600px at 10% -10%,#1e2a54,transparent),radial-gradient(900px 500px at 110% -10%,#1a2f60,transparent),#0b1020;display:grid;place-items:center;z-index:9999}
.lock .card{width:min(92vw,420px);background:var(--card);border:1px solid #22305c;border-radius:16px;padding:18px 16px 14px;box-shadow:0 15px 60px rgba(8,12,32,.5)}
.lock h2{margin:.1rem 0 .4rem;font-size:20px}
.lock .mut{color:var(--mut);font-size:13px;margin-bottom:10px}
.lock .pw{display:flex;gap:8px}
.lock input[type=password]{flex:1;padding:11px 12px;border-radius:10px;background:#0f152a;border:1px solid #1a2344;color:var(--ink)}
.lock .err{color:#ffb2b2;font-size:12.5px;min-height:18px;margin-top:8px}
.badge{display:inline-block;padding:2px 8px;border-radius:999px;background:#16325c;color:#bfe0ff;border:1px solid #295b9f;font-size:12px}
.tag-ok{background:#0e4220;color:#bff3c7;border:1px solid #1c8140}
.tag-warn{background:#442012;color:#ffd7d0;border:1px solid #883524}
.small{font-size:12px;color:#a7b9e2}
.hidden{display:none!important}
</style>
</head>
<body>
<header>
  <h1>📊 <span>MTurk</span> Earnings + Alerts + Monthly Transfers</h1>
  <p class="hint">Data live from Firebase — search, filter, export CSV. Locked with password.</p>
</header>

<div class="main">
  <div class="controls hidden" id="ctrls">
    <input id="q" class="input" placeholder="🔍 Filter by Worker, Bank, IP, Alert..." />
    <div>
      <button id="reload" class="btn">🔄 Refresh</button>
      <button id="csv" class="btn">📤 Export CSV</button>
    </div>
  </div>

  <div class="table-wrap hidden" id="wrap">
    <table>
      <thead>
        <tr>
          <th>Worker ID</th>
          <th>Current</th>
          <th>Last Transfer ($)</th>
          <th>Last Transfer Date</th>
          <th>Last Month Total ($)</th>
          <th>Next Transfer</th>
          <th>Bank</th>
          <th>IP</th>
          <th>Alert</th>
          <th>Updated</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="10" class="small">Waiting for unlock…</td></tr>
      </tbody>
    </table>
  </div>
</div>

<footer>© 2025 AB2Soft • Secured dashboard • Obfuscated client</footer>

<!-- 🔐 LOCK OVERLAY -->
<section class="lock" id="lock">
  <div class="card">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
      <span class="badge">🔒 Secure Access</span>
      <span class="small">Encrypted gate</span>
    </div>
    <h2>Enter password</h2>
    <p class="mut">Protected dashboard. Incorrect attempts are ignored.</p>
    <div class="pw">
      <input id="pw" type="password" placeholder="••••••••••••••" autocomplete="current-password">
      <button id="go" class="btn">Unlock</button>
    </div>
    <div id="err" class="err"></div>
  </div>
</section>

<script>
/* Basic anti-tamper (cosmetic): */
(function(d){
  d.addEventListener('contextmenu',e=>e.preventDefault(),{passive:false});
  d.addEventListener('keydown',e=>{
    const k=e.key.toLowerCase(), s=e.shiftKey, c=e.ctrlKey;
    if(k==='f12'||(c&&s&&(k==='i'||k==='j'||k==='c'))||(c&&k==='u')){e.preventDefault();}
  },{capture:true});
})(document);
</script>

<!-- 🔧 OBFUSCATED MODULE -->
<script type="module">
/* ===== OBFS START ===== */
const _B=(s)=>decodeURIComponent(escape(atob(s)));
const _H=async(t)=>{const e=new TextEncoder().encode(t);const h=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(h)).map(x=>x.toString(16).padStart(2,"0")).join("")};
const K={L:_B("bG9jaw=="),P:_B("cHc="),G:_B("Z28="),E:_B("ZXJy"),C:_B("Y3RybHM="),W:_B("d3JhcA=="),R:_B("cm93cw=="),Q:_B("cmVsb2Fk"),S:_B("Y3N2"),U:_B("anNvbg=="),D:_B("ZGF0YQ==")};
const $id=(x)=>document.getElementById(x);
const Sx=(x)=>{try{return JSON.parse(x)}catch{return null}};
const Fx=(mmddyy)=>{if(!mmddyy||typeof mmddyy!=="string")return null;const p=mmddyy.split("/");if(p.length!==3)return null;const [mm,dd,yy]=p;return `${yy}-${mm}`};
const Zz=(o)=>Object.keys(o)[0]??"";
const PASS_SHA256="9b724d9df97a91d297dc1c714a3987338ebb60a2a53311d2e382411a78b9e07d";/* "" */

const FBC=_B("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vZmlyZWJhc2Vqcy8xMC4xMi4wLw==");
const Aurl=FBC+_B("ZmlyZWJhc2UtYXBwLmpz");
const Furl=FBC+_B("ZmlyZWJhc2UtZmlyZXN0b3JlLmpz");

const CFG=Object.freeze({
  apiKey:_B("QUl6YVN5Q0N0QkNBSnZRU0RqOG1YcjJ3OTBxWVVRcVJyRU5JSUdJUU=="),
  authDomain:_B("bXR1cmstbW9uaXRvcmRlZXAuZmlyZWJhc2VhcHAuY29t"),
  projectId:_B("bXR1cmstbW9uaXRvcmRlZXBfZmlyZWJhc2VhcHA=")/* intentionally mangled to deter casual edits */,
  storageBucket:_B("bXR1cmstbW9uaXRvcmRlZXAuZmlyZWJhc2VzdG9yYWdlLmFwcA=="),
  messagingSenderId:_B("NTgzOTIyOTc0ODc="),
  appId:_B("MToyNTgzOTIyOTc0ODc6d2ViOjEzNjVhZDEyMTEwZmZkMDU4NjYzN2E=")
});

/* Gate & boot */
const boot=async()=>{
  const [appMod,fsMod]=await Promise.all([import(Aurl),import(Furl)]);
  const {initializeApp}=appMod; const {getFirestore,collection,getDocs,orderBy,query}=fsMod;
  const app=initializeApp(CFG); const db=getFirestore(app);

  /* DOM refs */
  const lock=$id(K.L), pw=$id(K.P), go=$id(K.G), err=$id(K.E);
  const ctrls=$id(K.C), wrap=$id(K.W), rows=$id(K.R), q=$id("q"), btnR=$id("reload"), btnX=$id("csv");

  const state={table:[], cacheMonth:{}};

  const monthKey=(s)=>Fx(s);

  const render=async()=>{
    rows.innerHTML=`<tr><td colspan="10" class="small">Loading…</td></tr>`;
    const qy=query(collection(db,"earnings_logs"),orderBy("timestamp","desc"));
    const snap=await getDocs(qy);

    /* Monthly buckets */
    const buckets={};
    snap.forEach(d=>{
      const v=d.data(); const mk=monthKey(v.lastTransferDate);
      if(mk){const amt=parseFloat(v.lastTransferAmount||0)||0; buckets[mk]=(buckets[mk]||0)+amt;}
    });

    state.table.length=0;
    let html="";
    snap.forEach(d=>{
      const v=d.data(); const mk=monthKey(v.lastTransferDate);
      const lastMonthTotal=(mk&&buckets[mk])?buckets[mk].toFixed(2):"0.00";
      const tms=v.timestamp?.seconds?new Date(v.timestamp.seconds*1000):new Date();
      const row={
        WorkerID:v.workerId||"",
        CurrentEarnings:v.currentEarnings??"",
        LastTransfer:(v.lastTransferAmount??""),
        LastTransferDate:(v.lastTransferDate??""),
        LastMonthTotal:lastMonthTotal,
        NextTransferDate:(v.nextTransferDate??""),
        BankAccount:(v.bankAccount??""),
        IP:(v.ip??""),
        Alert:(v.alert??"OK"),
        Updated:tms.toLocaleString()
      };
      state.table.push(row);
      const bad=(row.Alert&&String(row.Alert).toUpperCase()!=="OK");
      html+=`<tr class="${bad?"alert":""}">
        <td>${row.WorkerID}</td>
        <td>${row.CurrentEarnings}</td>
        <td>${row.LastTransfer}</td>
        <td>${row.LastTransferDate}</td>
        <td>${row.LastMonthTotal}</td>
        <td>${row.NextTransferDate}</td>
        <td>${row.BankAccount}</td>
        <td>${row.IP}</td>
        <td>${bad?`<span class="badge tag-warn">${row.Alert}</span>`:`<span class="badge tag-ok">OK</span>`}</td>
        <td>${row.Updated}</td>
      </tr>`;
    });
    rows.innerHTML=html||`<tr><td colspan="10" class="small">No records</td></tr>`;
  };

  const filter=()=>{
    const t=(q.value||"").toLowerCase();
    const trs=[...rows.querySelectorAll("tr")];
    trs.forEach(tr=>{
      const ok=tr.textContent.toLowerCase().includes(t);
      tr.style.display=ok?"":"none";
    });
  };

  const csv=()=>{
    if(!state.table.length){alert("No data to export.");return;}
    const keys=Object.keys(state.table[0]);
    const esc=(v)=>`"${String(v??"").replaceAll('"','""')}"`;
    const out=[keys.join(",")].concat(state.table.map(r=>keys.map(k=>esc(r[k])).join(","))).join("\n");
    const blob=new Blob([out],{type:"text/csv;charset=utf-8"}); const a=document.createElement("a");
    a.href=URL.createObjectURL(blob); a.download=`MTurk_Earnings_${new Date().toISOString().slice(0,10)}.csv`;
    document.body.appendChild(a); a.click(); a.remove();
  };

  /* Unlock handler */
  const unlock=async()=>{
    err.textContent="";
    const v=pw.value||"";
    if(!v){err.textContent="Password required.";return;}
    try{
      const h=await _H(v);
      if(h===PASS_SHA256){
        lock.classList.add("hidden");
        ctrls.classList.remove("hidden");
        wrap.classList.remove("hidden");
        await render();
      }else{
        err.textContent="Incorrect password.";
      }
    }catch(e){err.textContent="Error. Try again."; }
  };

  go.addEventListener("click",unlock);
  pw.addEventListener("keydown",(e)=>{if(e.key==="Enter")unlock();});
  btnR.addEventListener("click",render);
  btnX.addEventListener("click",csv);
  q.addEventListener("input",filter);
};

try{ boot(); }catch(_){ /* swallow */ }
/* ===== OBFS END ===== */
</script>
</body></html>
