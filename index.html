<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MTurk HITs Queue Monitor</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background:#fafafa; }
    h1 { color: #222; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
  </style>
</head>
<body>
  <h1>MTurk HITs Queue (via Webhook.site)</h1>
  <p>Auto-refreshes every 10s</p>
  <table>
    <thead>
      <tr>
        <th>Requester</th>
        <th>Title</th>
        <th>Reward</th>
        <th>Worker ID</th>
        <th>Assignment ID</th>
        <th>Hit ID</th>
        <th>Time Remaining</th>
        <th>Received At</th>
      </tr>
    </thead>
    <tbody id="hits">
      <tr><td colspan="8">Loading…</td></tr>
    </tbody>
  </table>

  <script>
    const API_TOKEN = "c118ce90-2599-4b3d-a0d7-74a646c68bf5"; // your API token
    const BIN_ID = "80b9e516-aa1b-4893-98d3-f805e22a358f";   // your bin id

    async function fetchHits() {
      try {
        const res = await fetch(`https://webhook.site/token/${API_TOKEN}/requests?bin=${BIN_ID}`, {
          headers: { "Authorization": `Bearer ${API_TOKEN}` }
        });

        if (!res.ok) throw new Error("API error " + res.status);
        const data = await res.json();

        const tbody = document.getElementById("hits");
        tbody.innerHTML = "";

        data.data.forEach(req => {
          if (req.method === "POST" && req.content) {
            try {
              const payload = JSON.parse(req.content);

              if (payload.event === "hit_accepted") {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                  <td>${payload.requester || "-"}</td>
                  <td>${payload.title || "-"}</td>
                  <td>${payload.reward || "-"}</td>
                  <td>${(payload.workerId || "-").replace("COPIED\\n", "")}</td>
                  <td>${payload.assignmentId || "-"}</td>
                  <td>${payload.hitId || "-"}</td>
                  <td>${payload.timeRemainingSeconds ? Math.floor(payload.timeRemainingSeconds/60) + "m " + (payload.timeRemainingSeconds%60) + "s" : "-"}</td>
                  <td>${payload.time || "-"}</td>
                `;
                tbody.appendChild(tr);
              }
            } catch (e) {
              console.log("Not JSON:", req.content);
            }
          }
        });

        if (!tbody.hasChildNodes()) {
          tbody.innerHTML = "<tr><td colspan='8'>No HITs found</td></tr>";
        }

      } catch (err) {
        console.error(err);
        document.getElementById("hits").innerHTML = 
          `<tr><td colspan='8'>⚠️ Error fetching data</td></tr>`;
      }
    }

    fetchHits();
    setInterval(fetchHits, 10000); // every 10s
  </script>
</body>
</html>
