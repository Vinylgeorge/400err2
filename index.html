<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>ðŸ“Š MTurk Earnings + Monthly Transfers + Alerts (Secure)</title><style>:root{--p:#2563eb;--p2:#1d4ed8;--bg:#f8fafc}*{box-sizing:border-box}body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);margin:0;padding:20px;color:#111}header{background:linear-gradient(135deg,#2563eb,#1e3a8a);color:#fff;padding:20px;border-radius:12px;text-align:center}main{margin-top:18px}.controls{display:flex;gap:10px;justify-content:space-between;flex-wrap:wrap;margin-bottom:12px}input[type=text]{padding:8px 10px;border:1px solid #e5e7eb;border-radius:8px;width:260px;font-size:14px}button{background:var(--p);border:0;color:#fff;padding:9px 14px;border-radius:8px;cursor:pointer}button:hover{background:var(--p2)}table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 2px 16px rgba(0,0,0,.06)}th,td{padding:10px 12px;border-bottom:1px solid #f1f5f9;text-align:left;font-size:14px}th{background:#f1f5f9}tr:hover{background:#f9fafb}tr.alert-row{background:#fee2e2!important;color:#b91c1c;font-weight:600}footer{margin-top:14px;text-align:center;color:#6b7280;font-size:12px}#gate{position:fixed;inset:0;background:linear-gradient(180deg,#0f172a 0,#111827 100%);display:flex;align-items:center;justify-content:center;z-index:9999}#gate .card{width:min(420px,92vw);background:#0b1220;border:1px solid #1f2937;border-radius:14px;padding:22px;color:#dbeafe;box-shadow:0 10px 40px rgba(0,0,0,.45)}#gate h2{margin:0 0 14px 0;font-weight:700;letter-spacing:.2px}#gate p{margin:0 0 12px 0;color:#93c5fd}#gate input{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0a1222;color:#e5e7eb;outline:none}#gate input:focus{border-color:#60a5fa;box-shadow:0 0 0 3px rgba(96,165,250,.25)}#gate button{width:100%;margin-top:12px;background:#22c55e}#gate button:hover{background:#16a34a}#gate .msg{margin-top:10px;font-size:12px;color:#fca5a5;min-height:16px}#app{display:none}</style></head><body>
<section id="gate" aria-label="Password Gate"><div class="card"><h2>ðŸ”’ Secure Access</h2><p>Enter password</p><input id="pw" type="password" inputmode="text" autocomplete="current-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"/><button id="unlockBtn">Unlock</button><div class="msg" id="gateMsg"></div></div></section>
<section id="app" aria-label="Dashboard App"><header><h1>ðŸ“Š MTurk Earnings + Alerts + Monthly Transfers</h1><p>Auto-synced from Firebase â€” grouped by transfer month</p></header><main><div class="controls"><input id="searchInput" type="text" placeholder="ðŸ” Filter by worker, bank, or alert..."/><div><button id="refreshBtn">ðŸ”„ Refresh</button><button id="exportBtn">ðŸ“¤ Export CSV</button></div></div><table aria-label="Earnings Table"><thead><tr><th>Worker ID</th><th>Current Earnings</th><th>Last Transfer ($)</th><th>Last Transfer Date</th><th>Last Month Transfer ($)</th><th>Next Transfer Date</th><th>Bank</th><th>IP</th><th>Alert</th><th>Updated</th></tr></thead><tbody id="dataBody"><tr><td colspan="10">Loadingâ€¦ (waiting unlock)</td></tr></tbody></table></main><footer>Â© 2025 AB2Soft | Monthly Summaries â€¢ Alert Monitor â€¢ CSV Export</footer></section>
<script type="module">
/* tiny string decoder */
const _X=(s)=>s.replace(/_/g,'/').replace(/-/g,'+');const _U=(s)=>decodeURIComponent(escape(atob(_X(s))));
/* expected SHA-256 of AB2EARNINGS2025 */
const H="9b724d9df97a91d297dc1c714a3987338ebb60a2a53311d2e382411a78b9e07d";
/* elements */
const G=document.getElementById("gate"),A=document.getElementById("app"),P=document.getElementById("pw"),B=document.getElementById("unlockBtn"),M=document.getElementById("gateMsg");
/* hex util */
const z=(buf)=>{let o="",v=new Uint8Array(buf);for(let i=0;i<v.length;i++)o+=v[i].toString(16).padStart(2,"0");return o};
/* sha */
const S=async(t)=>z(await crypto.subtle.digest("SHA-256",new TextEncoder().encode(t)));
/* unlock */
B.addEventListener("click",async()=>{M.textContent="";const t=(P.value||"").trim();if(!t){M.textContent="Password required";return}try{if(await S(t)===H){G.style.display="none";A.style.display="block";Q()}else M.textContent="Password incorrect"}catch(e){M.textContent="Crypto error: "+(e?.message||e)}});
P.addEventListener("keydown",(e)=>{if(e.key==="Enter")B.click()});
/* app */
async function Q(){
  const a1=_U("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vZmlyZWJhc2Vqcy8xMC4xMi4wL2ZpcmViYXNlLWFwcC5qcw");
  const a2=_U("aHR0cHM6Ly93d3cuZ3N0YXRpYy5jb20vZmlyZWJhc2Vqcy8xMC4xMi4wL2ZpcmViYXNlLWZpcmVzdG9yZS5qcw");
  const {initializeApp}=await import(a1);
  const {getFirestore,collection,getDocs,orderBy,query}=await import(a2);
  /* firebase config (mildly obfuscated) */
  const C=JSON.parse(_U("eyJhcGlLZXkiOiJBSXphU3lDQ3RCQ0FadlFXQ0RqOG1YZjJiOTBxWVVxUnJFTklJR0lRIiwiYXV0aERvbWFpbiI6Im10dXJrLW1vbml0b3JkZWVwLmZpcmViYXNlYXBwLmNvbSIsInByb2plY3RJZCI6Im10dXJrLW1vbml0b3JkZWVwIiwic3RvcmFnZUJ1Y2tldCI6Im10dXJrLW1vbml0b3JkZWVwLmZpcmViYXNlc3RvcmFnZS5hcHAiLCJtZXNzYWdpbmdTZW5kZXJJZCI6IjU4MzkyMjk3NDg3IiwiYXBwSWQiOiIxOjU4MzkyMjk3NDg3OndlYjoxMzY1YWQxMjExMGZmZDA1ODY2MzdhIn0="));
  const app=initializeApp(C); const db=getFirestore(app);
  const T=(d)=>{if(!d)return null;const p=String(d).split("/");if(p.length!==3)return null;const[mm,dd,yy]=p;return `${yy}-${mm}`};
  const U=(ts)=>{if(!ts)return"";try{if(typeof ts==="object"&&typeof ts.seconds==="number")return new Date(ts.seconds*1e3).toLocaleString();const d=new Date(ts);if(!isNaN(d))return d.toLocaleString()}catch{}return String(ts)};
  const body=document.getElementById("dataBody");let rows=[];
  async function L(){body.innerHTML="<tr><td colspan='10'>Loadingâ€¦</td></tr>";rows=[];
    try{
      const q=query(collection(db,"earnings_logs"),orderBy("timestamp","desc"));
      const snap=await getDocs(q);
      const monthSum={};
      snap.forEach(doc=>{const d=doc.data();const k=T(d.lastTransferDate);if(k){const a=parseFloat(d.lastTransferAmount||0);monthSum[k]=(monthSum[k]||0)+(isNaN(a)?0:a)}});
      let html="";
      snap.forEach(doc=>{
        const d=doc.data(),k=T(d.lastTransferDate),sum=k&&monthSum[k]?monthSum[k].toFixed(2):"0.00",bad=d.alert&&d.alert!=="OK"&&d.alert!=="âœ… OK";
        const r={WorkerID:d.workerId||"",CurrentEarnings:d.currentEarnings??"",LastTransfer:d.lastTransferAmount??"",LastTransferDate:d.lastTransferDate??"",LastMonthTotal:sum,NextTransferDate:d.nextTransferDate??"",BankAccount:d.bankAccount??"",IP:d.ip??"",Alert:d.alert||"OK",Updated:U(d.timestamp)};
        rows.push(r);
        html+=`<tr class="${bad?"alert-row":""}"><td>${r.WorkerID}</td><td>${r.CurrentEarnings}</td><td>${r.LastTransfer}</td><td>${r.LastTransferDate}</td><td>${r.LastMonthTotal}</td><td>${r.NextTransferDate}</td><td>${r.BankAccount}</td><td>${r.IP}</td><td>${r.Alert}</td><td>${r.Updated}</td></tr>`;
      });
      body.innerHTML=html||"<tr><td colspan='10'>No records found</td></tr>";
    }catch(e){console.error(e);body.innerHTML="<tr><td colspan='10'>Error loading data.</td></tr>"}
  }
  function F(){const v=document.getElementById("searchInput").value.toLowerCase();document.querySelectorAll("#dataBody tr").forEach(tr=>{tr.style.display=tr.textContent.toLowerCase().includes(v)?"":"none"})}
  function X(){if(!rows.length){alert("No data to export.");return}const H=Object.keys(rows[0]);const csv=[H.join(","),...rows.map(o=>H.map(h=>`"${String(o[h]??"").replace(/"/g,'""')}"`).join(","))].join("\n");const blob=new Blob([csv],{type:"text/csv;charset=utf-8;"});const a=document.createElement("a");a.href=URL.createObjectURL(blob);a.download=`MTurk_Earnings_${new Date().toISOString().slice(0,10)}.csv`;document.body.appendChild(a);a.click();a.remove()}
  document.getElementById("refreshBtn").addEventListener("click",L);
  document.getElementById("searchInput").addEventListener("input",F);
  document.getElementById("exportBtn").addEventListener("click",X);
  L();
}
</script>
</body></html>
